// Script to check if any required Empost fields are missing from CSV mapping

const fs = require('fs');
const path = require('path');

// Read CSV header
const csvPath = path.join(__dirname, '..', 'TRANSACTIONS OCT 2025.csv');
const csvContent = fs.readFileSync(csvPath, 'utf-8');
const lines = csvContent.split('\n');
const header = lines[0].split(',').map(h => h.trim().replace(/^\uFEFF/, ''));

console.log('üìã CSV COLUMNS AVAILABLE:');
header.forEach((col, idx) => {
  console.log(`  ${idx + 1}. ${col}`);
});

// Required Empost Shipment Fields (based on previous validation errors)
const requiredEmpostFields = {
  // Top level
  trackingNumber: 'AWB NUMBER',
  uhawb: 'N/A (generated by Empost)',
  
  // Sender
  'sender.name': 'SENDER NAME',
  'sender.email': '‚ùå MISSING - Using "N/A"',
  'sender.phone': '‚ùå MISSING - Using "N/A"',
  'sender.countryCode': 'ORIGIN (inferred)',
  'sender.city': 'ORIGIN',
  'sender.line1': 'ORIGIN',
  
  // Receiver
  'receiver.name': 'RECEIVER NAME',
  'receiver.phone': '‚ùå MISSING - Using "N/A"',
  'receiver.email': '‚ùå MISSING - Using "N/A"',
  'receiver.countryCode': 'COUNTRY OF DESTINATION',
  'receiver.city': 'DESTINATION',
  'receiver.line1': 'DESTINATION',
  
  // Details
  'details.weight.value': 'WEIGHT',
  'details.weight.unit': 'Hardcoded: "KG"',
  'details.declaredWeight.value': 'WEIGHT (same as weight)',
  'details.declaredWeight.unit': 'Hardcoded: "KG"',
  'details.deliveryCharges.amount': 'DELIVERY CHARGE RATE BEFORE DISCOUNT',
  'details.deliveryCharges.currencyCode': 'Hardcoded: "AED"',
  'details.pickupDate': 'INVOICE DATE',
  'details.shippingType': 'SERVICE TYPE (mapped)',
  'details.productCategory': 'SHIPMENT TYPE',
  'details.productType': 'Hardcoded: "Parcel"',
  'details.descriptionOfGoods': 'SHIPMENT TYPE',
  'details.dimensions': 'Calculated from weight',
  'details.numberOfPieces': 'Hardcoded: 1',
  
  // Items
  'items[0].description': 'SHIPMENT TYPE',
  'items[0].countryOfOrigin': 'ORIGIN (inferred country code)',
  'items[0].quantity': 'Hardcoded: 1',
  'items[0].hsCode': 'Hardcoded: "8504.40"',
};

console.log('\n\nüîç EMPOST REQUIRED FIELDS MAPPING:\n');
console.log('Field'.padEnd(40) + 'CSV Source'.padEnd(50) + 'Status');
console.log('‚îÄ'.repeat(100));

for (const [field, source] of Object.entries(requiredEmpostFields)) {
  const status = source.includes('‚ùå') ? '‚ö†Ô∏è  MISSING' : 
                 source.includes('Hardcoded') ? '‚úÖ DEFAULT' :
                 source.includes('inferred') ? '‚úÖ INFERRED' :
                 source.includes('Calculated') ? '‚úÖ CALCULATED' :
                 source.includes('mapped') ? '‚úÖ MAPPED' :
                 '‚úÖ AVAILABLE';
  
  console.log(field.padEnd(40) + source.padEnd(50) + status);
}

console.log('\n\n‚ö†Ô∏è  POTENTIALLY MISSING FIELDS:\n');
console.log('1. sender.email - Set to "N/A" (may cause issues if Empost requires valid email)');
console.log('2. sender.phone - Set to "N/A" (may cause issues if Empost requires valid phone)');
console.log('3. receiver.phone - Set to "N/A" (may cause issues if Empost requires valid phone)');
console.log('4. receiver.email - Set to "N/A" (may cause issues if Empost requires valid email)');
console.log('5. receiver.line1 - Using DESTINATION city (may need full address)');
console.log('6. sender.line1 - Using ORIGIN city (may need full address)');

console.log('\n\nüìù RECOMMENDATIONS:\n');
console.log('‚úÖ All critical fields are mapped');
console.log('‚ö†Ô∏è  Contact/Address fields use "N/A" or city names only');
console.log('üí° Consider if Empost API accepts "N/A" for optional fields');
console.log('üí° If Empost rejects "N/A", may need to provide default values or make fields optional');

